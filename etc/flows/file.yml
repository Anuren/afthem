request:
  next: transform_headers
  sidecars:
    - access_logger
  config:
    discard_headers:
      - host
      - content-length

transform_headers:
  next: upstream_file
  config:
    add:
      - name: x-foo
        value: bar
      - name: user-agent
        value: "#msg.request().getHeader('user-agent')+' - Afthem'"
        evaluated: true

upstream_file:
  next: send_back
  sidecars:
    - generic_logger
  config:
    subpath: mock

send_back:
  sidecars:
    - access_logger

generic_logger:
  config:
    value: "'loaded file for : '+#msg.request().url()"
    evaluated: true

access_logger:
  config: {}