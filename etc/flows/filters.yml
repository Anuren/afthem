proxy/request:
  next: filter/header_filter
  sidecars:
    - sidecar/access_logger
  config:
    discard_headers:
      - host

filter/header_filter:
  next: filter/delay_filter
  sidecars:
    - sidecar/access_logger
  config:
    accept:
      - value: "#msg.request().getHeader('key')=='ABC123'"
        evaluated: true
      - value: "#msg.request().getHeader('accept')=='application/json'"
        evaluated: true
    reject:
      - value: "#msg.request().method()!='GET'"
        evaluated: true

filter/delay_filter:
  next: proxy/upstream_http
  config:
    delay: 5 seconds

proxy/upstream_http:
  next: proxy/send_back
  config:
    discard_headers:
      - "content-length"

proxy/send_back:
  sidecars:
    - sidecar/access_logger

sidecar/access_logger:
  config: {}